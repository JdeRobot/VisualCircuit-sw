{"editor":{"id":"01293f53-c004-44fc-886c-5c26f7124425","offsetX":1,"offsetY":1,"zoom":100,"gridSize":0,"layers":[{"id":"67802fac-b475-41ed-8853-e5b7fe1dda24","type":"diagram-links","isSvg":true,"transformed":true,"models":{"9b4e144e-d7f7-4b2c-bdc6-d211f8dd41f3":{"id":"9b4e144e-d7f7-4b2c-bdc6-d211f8dd41f3","type":"default","selected":false,"source":"0001-311d4fd6-c88e-48ac-811b-323953cb854c","sourcePort":"f7b3eb1d-994b-4687-b419-72519a6a6b24","target":"bcdd21f5-011c-4407-9bd9-b2edde54ffce","targetPort":"ff38fed2-4cad-47d9-97eb-67fe8aee36f0","points":[{"id":"6439f9c8-6ce5-4fbc-9e3c-9186114c9999","type":"point","x":664,"y":124.69999694824219},{"id":"f998ea38-b240-47cd-af54-9a2aba8d75c1","type":"point","x":598.7374877929688,"y":194.5}],"labels":[],"width":3,"color":"gray","curvyness":50,"selectedColor":"rgb(0,192,255)"},"7fa42594-f088-4d9d-9a29-9509689f342a":{"id":"7fa42594-f088-4d9d-9a29-9509689f342a","type":"default","selected":false,"source":"0002-50be6404-1865-4676-a867-9b7b90b6d117","sourcePort":"b94d3519-cd66-4840-94c8-794abbeef5f2","target":"bcdd21f5-011c-4407-9bd9-b2edde54ffce","targetPort":"94a788d8-6ac9-417c-8181-7fd28c5cb414","points":[{"id":"cbcd8473-7439-46ae-bec1-1055b3157721","type":"point","x":818,"y":127.69999694824219},{"id":"f4a30df2-ca4b-4140-b742-20ac91a6b877","type":"point","x":895.1875,"y":194.5}],"labels":[],"width":3,"color":"gray","curvyness":50,"selectedColor":"rgb(0,192,255)"},"1263d1f7-9687-49be-9f58-a0d401f75b9e":{"id":"1263d1f7-9687-49be-9f58-a0d401f75b9e","type":"default","selected":false,"source":"af3b9847-7555-45fc-843c-117668b22e27","sourcePort":"6553b3b2-ce98-491e-aa43-b6e65ce803a6","target":"bcdd21f5-011c-4407-9bd9-b2edde54ffce","targetPort":"cf2a592e-c477-4758-a83b-63d8e094770e","points":[{"id":"d98b4fe7-94d3-4b10-83cf-e00edb0b07bf","type":"point","x":229.5,"y":361.6000061035156},{"id":"80b9d269-e586-455e-8edd-7be7ce06c2d1","type":"point","x":331.5,"y":351.5}],"labels":[],"width":3,"color":"gray","curvyness":50,"selectedColor":"rgb(0,192,255)"},"0a4214bc-59a0-46a5-9b34-7460f173cbfc":{"id":"0a4214bc-59a0-46a5-9b34-7460f173cbfc","type":"default","selected":false,"source":"bcdd21f5-011c-4407-9bd9-b2edde54ffce","sourcePort":"32acfcfb-9dcf-4868-a235-346281c12bf3","target":"b4f9ed44-3cc7-4877-b4f0-9d06fe37d918","targetPort":"cc62b360-0ada-4a2a-804c-17f5fac0d31c","points":[{"id":"b7f8f71d-666d-4343-9564-a70cda205c9b","type":"point","x":1161.1624755859375,"y":351.5},{"id":"57532e0e-ca5f-4dcb-9ecf-dad16f1a089d","type":"point","x":1247.5,"y":352.6000061035156}],"labels":[],"width":3,"color":"gray","curvyness":50,"selectedColor":"rgb(0,192,255)"}}},{"id":"770eac94-df11-4a66-8b47-b1c61c7f81d7","type":"diagram-nodes","isSvg":false,"transformed":true,"models":{"0001-311d4fd6-c88e-48ac-811b-323953cb854c":{"id":"0001-311d4fd6-c88e-48ac-811b-323953cb854c","type":"basic.constant","selected":false,"x":603,"y":9,"ports":[{"id":"f7b3eb1d-994b-4687-b419-72519a6a6b24","type":"port.output","x":656.5,"y":117.19999694824219,"name":"constant-out","alignment":"bottom","parentNode":"0001-311d4fd6-c88e-48ac-811b-323953cb854c","links":["9b4e144e-d7f7-4b2c-bdc6-d211f8dd41f3"],"in":false,"label":"constant-out","hideLabel":true}],"data":{"name":"Frequency","value":"30.0","local":true}},"0002-50be6404-1865-4676-a867-9b7b90b6d117":{"id":"0002-50be6404-1865-4676-a867-9b7b90b6d117","type":"basic.constant","selected":false,"x":757,"y":12,"ports":[{"id":"b94d3519-cd66-4840-94c8-794abbeef5f2","type":"port.output","x":810.5,"y":120.19999694824219,"name":"constant-out","alignment":"bottom","parentNode":"0002-50be6404-1865-4676-a867-9b7b90b6d117","links":["7fa42594-f088-4d9d-9a29-9509689f342a"],"in":false,"label":"constant-out","hideLabel":true}],"data":{"name":"ROS Topic","value":"/robot/camera","local":true}},"bcdd21f5-011c-4407-9bd9-b2edde54ffce":{"id":"bcdd21f5-011c-4407-9bd9-b2edde54ffce","type":"basic.code","selected":false,"x":323,"y":186,"ports":[{"id":"cf2a592e-c477-4758-a83b-63d8e094770e","type":"port.input","x":324,"y":344,"name":"E","alignment":"left","parentNode":"bcdd21f5-011c-4407-9bd9-b2edde54ffce","links":["1263d1f7-9687-49be-9f58-a0d401f75b9e"],"in":true,"label":"E","hideLabel":false},{"id":"32acfcfb-9dcf-4868-a235-346281c12bf3","type":"port.output","x":1153.6624755859375,"y":344,"name":"Out","alignment":"right","parentNode":"bcdd21f5-011c-4407-9bd9-b2edde54ffce","links":["0a4214bc-59a0-46a5-9b34-7460f173cbfc"],"in":false,"label":"Out","hideLabel":false},{"id":"ff38fed2-4cad-47d9-97eb-67fe8aee36f0","type":"port.parameter","x":591.2374877929688,"y":187,"name":"Frequency","alignment":"top","parentNode":"bcdd21f5-011c-4407-9bd9-b2edde54ffce","links":["9b4e144e-d7f7-4b2c-bdc6-d211f8dd41f3"],"in":true,"label":"Frequency","hideLabel":false},{"id":"94a788d8-6ac9-417c-8181-7fd28c5cb414","type":"port.parameter","x":887.6875,"y":187,"name":"ROSTopic","alignment":"top","parentNode":"bcdd21f5-011c-4407-9bd9-b2edde54ffce","links":["7fa42594-f088-4d9d-9a29-9509689f342a"],"in":true,"label":"ROSTopic","hideLabel":false}],"data":{"code":"#!/usr/bin/env python3\n\nimport numpy as np\nimport rospy\nfrom cv_bridge import CvBridge\nfrom sensor_msgs.msg import Image\nfrom time import sleep\nfrom utils.wires.wire_img import share_image\nfrom utils.wires.wire_str import read_string\nfrom utils.tools.freq_monitor import monitor_frequency\n\nbridge = CvBridge()\nimg = None\n\ndef callback(msg):\n    \n    global img\n    img = np.asarray(bridge.imgmsg_to_cv2(msg, \"bgr8\"), dtype=np.uint8)\n\ndef loop(block_name, input_wires, output_wires, parameters, flags):\n\n    output_0 = share_image(output_wires[0])\n\n    enabled = False\n    try:\n        enable_wire = read_string(input_wires[0])\n    except IndexError:\n        enabled = True\n\n    required_frequency, update = float(parameters[0]), 1\n    control_data = np.array([0.0,0.03])\n\n    if flags[0] == 1:\n        monitor_frequency(block_name, control_data, required_frequency, update)\n\n    rospy.init_node(\"camera_ros\", anonymous=True)\n    \n    camera_subscriber = rospy.Subscriber(parameters[1], Image, callback)\n    \n    while img is None:\n        pass\n\n    try:\n    \n        while not rospy.is_shutdown():\n    \n            if enabled or (update := bool(enable_wire.get()[0])):\n            \n                output_0.add(img)\n                control_data[0] += 1\n                \n            sleep(control_data[1])       \n    \n    except KeyboardInterrupt:\n    \n        enable_wire.release()\n        output_0.release()\n","params":[{"name":"Frequency"},{"name":"ROSTopic"}],"ports":{"in":[{"name":"E"}],"out":[{"name":"Out"}]},"size":{"width":"788px","height":"271px"}}},"af3b9847-7555-45fc-843c-117668b22e27":{"id":"af3b9847-7555-45fc-843c-117668b22e27","type":"basic.input","selected":false,"x":136,"y":335,"ports":[{"id":"6553b3b2-ce98-491e-aa43-b6e65ce803a6","type":"port.output","x":222,"y":354.1000061035156,"name":"input-out","alignment":"right","parentNode":"af3b9847-7555-45fc-843c-117668b22e27","links":["1263d1f7-9687-49be-9f58-a0d401f75b9e"],"in":false,"label":"input-out","hideLabel":true}],"data":{"name":"E"}},"b4f9ed44-3cc7-4877-b4f0-9d06fe37d918":{"id":"b4f9ed44-3cc7-4877-b4f0-9d06fe37d918","type":"basic.output","selected":false,"x":1239,"y":326,"ports":[{"id":"cc62b360-0ada-4a2a-804c-17f5fac0d31c","type":"port.input","x":1240,"y":345.1000061035156,"name":"output-in","alignment":"left","parentNode":"b4f9ed44-3cc7-4877-b4f0-9d06fe37d918","links":["0a4214bc-59a0-46a5-9b34-7460f173cbfc"],"in":true,"label":"output-in","hideLabel":true}],"data":{"name":"Out"}}}}]},"version":"3.0","package":{"name":"CameraROS","version":"1.0.0","description":"Captures Video Stream from Simulated ROS Camera","author":"Muhammad Taha Suhail","image":"data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjQ3MnB0IiB2aWV3Qm94PSIwIC04NyA0NzIgNDcyIiB3aWR0aD0iNDcycHQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTQ2MiAzNS4xMjEwOTR2MjI3LjgyMDMxMmwtMTIxLjg3ODkwNi02Ni41NTA3ODFoLTEuMjEwOTM4di05NC43MTg3NWgxLjIxMDkzOHptMCAwIiBmaWxsPSIjMDBhY2VhIi8+PHBhdGggZD0ibTMzOC45MTAxNTYgMTk2LjM5MDYyNXY1MS4wMzEyNWMwIDIyLjA4OTg0NC0xNy45MTAxNTYgNDAtNDAgNDBoLTI0OC45MTAxNTZjLTIyLjA4OTg0NCAwLTQwLTE3LjkxMDE1Ni00MC00MHYtMTk3LjQyMTg3NWMwLTIyLjA4OTg0NCAxNy45MTAxNTYtNDAgNDAtNDBoMjQ4LjkxMDE1NmMyMi4wODk4NDQgMCA0MCAxNy45MTAxNTYgNDAgNDB6bTAgMCIgZmlsbD0iIzAwZWZkMSIvPjxwYXRoIGQ9Im00NjcuMTAxNTYyIDI2LjUxOTUzMWMtMy4wMzkwNjItMS44MDA3ODEtNi43OTY4NzQtMS44NjcxODctOS44OTg0MzctLjE3NTc4MWwtMTA4LjI5Njg3NSA1OS4xMzI4MTJ2LTM1LjQ3NjU2MmMtLjAzMTI1LTI3LjYwMTU2Mi0yMi4zOTg0MzgtNDkuOTY4NzUtNTAtNTBoLTI0OC45MDYyNWMtMjcuNjAxNTYyLjAzMTI1LTQ5Ljk2ODc1IDIyLjM5ODQzOC01MCA1MHYxOTcuNDIxODc1Yy4wMzEyNSAyNy41OTc2NTYgMjIuMzk4NDM4IDQ5Ljk2NDg0NCA1MCA1MGgyNDguOTEwMTU2YzI3LjYwMTU2My0uMDM1MTU2IDQ5Ljk2ODc1LTIyLjQwMjM0NCA1MC01MHYtMzQuODM5ODQ0bDEwOC4zMDA3ODIgNTkuMTMyODEzYzMuMDk3NjU2IDEuNjkxNDA2IDYuODU1NDY4IDEuNjI1IDkuODkwNjI0LS4xNzU3ODIgMy4wMzUxNTctMS44MDQ2ODcgNC44OTg0MzgtNS4wNzAzMTIgNC44OTg0MzgtOC42MDE1NjJ2LTIyNy44MTY0MDZjMC0zLjUzMTI1LTEuODYzMjgxLTYuODAwNzgyLTQuODk4NDM4LTguNjAxNTYzem0tMTM4LjE5MTQwNiAyMjAuOTAyMzQ0Yy0uMDE5NTMxIDE2LjU1ODU5NC0xMy40Mzc1IDI5Ljk4MDQ2OS0zMCAzMGgtMjQ4LjkxMDE1NmMtMTYuNTYyNS0uMDE5NTMxLTI5Ljk4MDQ2OS0xMy40NDE0MDYtMzAtMzB2LTE5Ny40MjE4NzVjLjAxOTUzMS0xNi41NjI1IDEzLjQzNzUtMjkuOTgwNDY5IDMwLTMwaDI0OC45MTAxNTZjMTYuNTYyNS4wMTk1MzEgMjkuOTgwNDY5IDEzLjQzNzUgMzAgMzB6bTEyMy4wODk4NDQtMS4zMzU5MzctMTAzLjA4OTg0NC01Ni4yODkwNjN2LTgxLjUzMTI1bDEwMy4wODk4NDQtNTYuMjkyOTY5em0wIDAiIGZpbGw9IiMwODM4NjMiLz48L3N2Zz4="},"design":{"board":"Python3-Noetic","graph":{"blocks":[{"id":"0001-311d4fd6-c88e-48ac-811b-323953cb854c","type":"basic.constant","data":{"name":"Frequency","value":"30.0","local":true},"position":{"x":603,"y":9}},{"id":"0002-50be6404-1865-4676-a867-9b7b90b6d117","type":"basic.constant","data":{"name":"ROS Topic","value":"/robot/camera","local":true},"position":{"x":757,"y":12}},{"id":"bcdd21f5-011c-4407-9bd9-b2edde54ffce","type":"basic.code","data":{"code":"#!/usr/bin/env python3\n\nimport numpy as np\nimport rospy\nfrom cv_bridge import CvBridge\nfrom sensor_msgs.msg import Image\nfrom time import sleep\nfrom utils.wires.wire_img import share_image\nfrom utils.wires.wire_str import read_string\nfrom utils.tools.freq_monitor import monitor_frequency\n\nbridge = CvBridge()\nimg = None\n\ndef callback(msg):\n    \n    global img\n    img = np.asarray(bridge.imgmsg_to_cv2(msg, \"bgr8\"), dtype=np.uint8)\n\ndef loop(block_name, input_wires, output_wires, parameters, flags):\n\n    output_0 = share_image(output_wires[0])\n\n    enabled = False\n    try:\n        enable_wire = read_string(input_wires[0])\n    except IndexError:\n        enabled = True\n\n    required_frequency, update = float(parameters[0]), 1\n    control_data = np.array([0.0,0.03])\n\n    if flags[0] == 1:\n        monitor_frequency(block_name, control_data, required_frequency, update)\n\n    rospy.init_node(\"camera_ros\", anonymous=True)\n    \n    camera_subscriber = rospy.Subscriber(parameters[1], Image, callback)\n    \n    while img is None:\n        pass\n\n    try:\n    \n        while not rospy.is_shutdown():\n    \n            if enabled or (update := bool(enable_wire.get()[0])):\n            \n                output_0.add(img)\n                control_data[0] += 1\n                \n            sleep(control_data[1])       \n    \n    except KeyboardInterrupt:\n    \n        enable_wire.release()\n        output_0.release()\n","params":[{"name":"Frequency"},{"name":"ROSTopic"}],"ports":{"in":[{"name":"E"}],"out":[{"name":"Out"}]},"size":{"width":"788px","height":"271px"}},"position":{"x":323,"y":186}},{"id":"af3b9847-7555-45fc-843c-117668b22e27","type":"basic.input","data":{"name":"E"},"position":{"x":136,"y":335}},{"id":"b4f9ed44-3cc7-4877-b4f0-9d06fe37d918","type":"basic.output","data":{"name":"Out"},"position":{"x":1239,"y":326}}],"wires":[{"source":{"block":"0001-311d4fd6-c88e-48ac-811b-323953cb854c","port":"constant-out"},"target":{"block":"bcdd21f5-011c-4407-9bd9-b2edde54ffce","port":"Frequency"}},{"source":{"block":"0002-50be6404-1865-4676-a867-9b7b90b6d117","port":"constant-out"},"target":{"block":"bcdd21f5-011c-4407-9bd9-b2edde54ffce","port":"ROSTopic"}},{"source":{"block":"af3b9847-7555-45fc-843c-117668b22e27","port":"input-out"},"target":{"block":"bcdd21f5-011c-4407-9bd9-b2edde54ffce","port":"E"}},{"source":{"block":"bcdd21f5-011c-4407-9bd9-b2edde54ffce","port":"Out"},"target":{"block":"b4f9ed44-3cc7-4877-b4f0-9d06fe37d918","port":"output-in"}}]}},"dependencies":{}}